<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retrofit</title>
    <link rel="shortcut icon" href="./image/head.jpg">

    <link rel="stylesheet" href="node_modules/material-components-web/dist/material-components-web.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/article.css">
    <link rel="stylesheet" href="./css/basic.css">

    <script type="text/javascript" src="./js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap.min.js"></script>
    <script type="text/javascript" src="node_modules/material-components-web/dist/material-components-web.js"></script>
    <script type="text/javascript" src="./js/header.js"></script>
</head>

<body>
    <article>
        <div class="mdc-card">
            <section class="mdc-card__primary">
                <h1 class="mdc-card__title">Retrofit</h1>
            </section>
        </div>
        <div class="mdc-card">
            <p>
                <strong>Retrofitæ˜¯Squareå…¬å¸æ¨å‡ºçš„ä¸€ä¸ªåŸºäºRESTfulé£æ ¼çš„HTTPç½‘ç»œæ¡†æ¶</strong><br />
                ä¸OkHttpçš„å…³ç³»ï¼šæ˜¯å¯¹OkHttpç½‘ç»œè¯·æ±‚æ¡†æ¶çš„äºŒæ¬¡å°è£…ï¼Œæœ¬è´¨ä»æ˜¯OkHttpã€‚å³ç½‘ç»œè¯·æ±‚çš„å·¥ä½œæœ¬è´¨ä¸Šæ˜¯ç”±OkHttpå®Œæˆï¼Œè€ŒRetrofitä»…è´Ÿè´£ç½‘ç»œè¯·æ±‚æ¥å£çš„å°è£…ã€‚<br />
                <br />
                <img src="./image/retrofit_1.png" style="width: 100%;"><br />
                â€¢ Appåº”ç”¨ç¨‹åºé€šè¿‡Retrofitè¯·æ±‚ç½‘ç»œï¼Œå®é™…ä¸Šæ˜¯ä½¿ç”¨Retrofitæ¥å£å±‚å°è£…è¯·æ±‚å‚æ•°ã€Headerã€Urlç­‰ä¿¡æ¯ï¼Œä¹‹åç”±OkHttpå®Œæˆåç»­çš„è¯·æ±‚æ“ä½œã€‚<br />
                â€¢ åœ¨æœåŠ¡ç«¯è¿”å›æ•°æ®ä¹‹åï¼ŒOkHttpå°†åŸå§‹çš„ç»“æœäº¤ç»™Retrofitï¼ŒRetrofitä¼šæ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å¯¹ç»“æœè¿›è¡Œè§£æã€‚<br />
                â€¢ é€šè¿‡ä½¿ç”¨å¤§é‡çš„è®¾è®¡æ¨¡å¼è¿›è¡ŒåŠŸèƒ½æ¨¡å—çš„è§£è€¦ï¼Œä½¿å¾—ä¸Šé¢çš„è¿‡ç¨‹è¿›è¡Œå¾—æ›´åŠ ç®€å•å’Œæµç•…ã€‚
            </p>
            <p>
            <h4><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></h4>
            <strong>â‘ æ·»åŠ Retrofitåº“ã€æ•°æ®è§£æå™¨åº“çš„ä¾èµ–ï¼Œæ³¨å†Œç½‘ç»œæƒé™</strong><br />
            &nbsp;&nbsp;&nbsp;&nbsp;åœ¨appåŒ…ä¸‹çš„build.gradleä¸­æ·»åŠ ä¾èµ–<br />
            <pre>implementation 'com.squareup.retrofit2:retrofit:2.9.0'
implementation 'com.squareup.retrofit2:converter-gson:2.9.0'</pre>
            &nbsp;&nbsp;&nbsp;&nbsp;åœ¨AndroidMainfest.xmlä¸­æ³¨å†Œæƒé™
            <pre>uses-permission android:name="android.permission.INTERNET"</pre>
            </p>
            <p>
                <strong>â‘¡åˆ›å»ºæ¥æ”¶æœåŠ¡å™¨è¿”å›æ•°æ®çš„ç±»</strong><br />
                è¯·æ±‚åæœåŠ¡å™¨ä¼šè¿”å›æ•°æ®ï¼Œéœ€è¦æ ¹æ®è¿”å›æ•°æ®çš„æ ¼å¼å’Œè§£ææ–¹å¼ï¼ˆJsonã€XMLç­‰ï¼‰æ¥å®šä¹‰0å®ä½“ç±»Modelã€‚
                å‡è®¾æœ‰è¿”å›æ•°æ®æ ¼å¼ä¸ºå¦‚ä¸‹JSONï¼Œå…¶ä¸­ï¼Œå¦‚æœç”¨æˆ·åå’Œå¯†ç åŒ¹é…æˆåŠŸï¼Œåˆ™codeå€¼ä¸º1ï¼Œåä¹‹ä¸ºï¼š
            <pre>{
    "code":1,
    "data":{
        "id":10001,
        "username":"Tom",
        "email":"888888888@qq.com",
        "tel":"18088888888"
    },
    "message":"success"
}</pre>
            å¯¹åº”çš„å®ä½“ç±»UserInfoModelï¼š
            <pre>
public class UserInfoModel {
    
    public int code;
    public UserInfo data;
    public String message;

    public static class UserInfo{

        public int id;
        public String username;
        public String email;
        public String tel;
    }
}</pre>
            </p>
            <p>
                <strong>â‘¢åˆ›å»ºç”¨äºæè¿°ç½‘ç»œè¯·æ±‚çš„æ¥å£</strong><br />
                å®šä¹‰ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„æ¥å£ï¼Œæ¥å£å‡½æ•°é‡Œè¦å®šä¹‰URLè·¯å¾„ã€è¯·æ±‚å‚æ•°ã€è¿”å›ç±»å‹ã€‚å…¶ä¸­ï¼Œéœ€è¦ä½¿ç”¨æ³¨è§£æ¥æè¿°è¯·æ±‚ç±»å‹å’Œè¯·æ±‚å‚æ•°ã€‚<br />
            <pre>public interface Interface {

    @GET("URL")
    Call<Model> getCall(@Query("xxx") String xxx);
    <i>// ç”¨ @GET("URL")å£°æ˜äº†URLè·¯å¾„</i>
    <i>// ç”¨ getCall()æ¥æ”¶ç½‘ç»œè¯·æ±‚æ•°æ®ï¼Œå¹¶ç”¨æ³¨è§£ @Query("xxx")å£°æ˜äº†è¯·æ±‚å‚æ•°</i>
    <i>// è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Retrofit çš„ Call å¯¹è±¡ï¼Œè¿™é‡Œå£°æ˜äº†è¿™ä¸ªå¯¹è±¡å¤„ç†çš„æ•°æ®ç±»å‹ä¸ºè‡ªå®šä¹‰ Model</i>   
}</pre>

            ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œåœ¨ä¸Šä¾‹ä¸­ï¼Œå¯¹åº”çš„UserMgrServiceæ¥å£å¦‚ä¸‹ï¼Œå½“å‘é€è¯·æ±‚å‚æ•°ä¸ºTomå’Œ123456æ—¶ï¼Œè¯·æ±‚å°†å‘é€ç»™çš„URLä¸ºã€login?username=Tom&pwd=123456ã€ï¼Œå¹¶ä¼šè¿”å›ä¹‹å‰å®šä¹‰çš„GSONæ•°æ®ï¼š
            <pre>public interface UserMgrService{
@GET("login")
Call<UserInfoModel> login(@Query("username") String username,
    @Query("pwd") String pwd);
}</pre>
            å¸¸ç”¨æ³¨è§£å«ä¹‰å¦‚ä¸‹è¡¨
            <img src="./image/retrofit_2.png" style="width: 100%;"><br />
            æ³¨ï¼š@GETå’Œ@Queryæ­é…ä½¿ç”¨ï¼Œ@POSTå’Œ@Fieldæ­é…ä½¿ç”¨
            </p>
            <p>
                <strong>â‘£åˆ›å»ºRetrofitå¯¹è±¡å¹¶è®¾ç½®æ•°æ®è§£æå™¨</strong><br />
            <pre>Retrofit retrofit = new Retrofit.Builder()
    .baseUrl("URL") <i>//è®¾ç½®ç½‘ç»œè¯·æ±‚çš„Urlåœ°å€ï¼Œæ³¨æ„ä»¥è¦ä»¥æ–œçº¿ç»“å°¾</i>
    .addConverterFactory(GsonConverterFactory.create()) <i>//è®¾ç½®æ•°æ®è§£æå™¨ï¼Œè¿™é‡Œè¡¨ç¤ºç”¨çš„æ˜¯JSONè§£æè¿”å›å€¼</i>
.build();</pre>
            </p>
            <p>
                <strong>â‘¤ç”Ÿæˆæ¥å£å¯¹è±¡</strong><br />
                ç”±äºæ˜¯interfaceä¸æ˜¯classï¼Œæ— æ³•ç›´æ¥è°ƒç”¨å†…éƒ¨æ–¹æ³•ï¼Œéœ€è¦åˆ©ç”¨å·²åˆ›å»ºçš„Retrofitå¯¹è±¡å»ç”Ÿæˆä»£ç†çš„æ¥å£å¯¹è±¡
            <pre>UserMgrService service = retrofit.create(UserMgrService.class);</pre>
            </p>
            <p>
                <strong>â‘¥è°ƒç”¨æ¥å£æ–¹æ³•è¿”å›Callå¯¹è±¡</strong><br />
                è°ƒç”¨æ¥å£å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå¯ä»¥æ‰§è¡Œç½‘ç»œè®¿é—®çš„ç½‘ç»œå·¥ä½œå¯¹è±¡ã€‚
            <pre>Call<UserInfoModel> call = service.login("Tom", "123456");</pre>
            </p>
            <p>
                <strong>â‘¦å‘é€ç½‘ç»œè¯·æ±‚ï¼ˆå¼‚æ­¥/åŒæ­¥ï¼‰</strong><br />
                åŒæ­¥ï¼šè°ƒç”¨Callå¯¹è±¡execute()ï¼Œè¿”å›ç»“æœæ˜¯å“åº”ä½“ã€‚
            <pre>
<i>//å¼€çº¿ç¨‹è¿›è¡Œç½‘ç»œè¯·æ±‚</i>
new Thread(new Runable()){
    @Override
    public void run(){
        Response<UserInfoModel> response=null;
        try{
            response=call.execute();
        }catch{
            e.printStackTrace();
        }
        <i>//å¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®</i>
    }
}.start();
                </pre>
            å¼‚æ­¥ï¼šè°ƒç”¨Callå¯¹è±¡exqueue()ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒã€‚
            <pre>
<i>//å¼‚æ­¥æ—¶ï¼Œæ¡†æ¶ä¸­å·²ç»å°è£…å¥½æ•°æ®è½¬æ¢ã€çº¿ç¨‹åˆ‡æ¢çš„æ“ä½œï¼Œæ— éœ€æ‰‹åŠ¨å¼€çº¿ç¨‹</i>
call.enqueue(new CallBack<UserInfoModel>(){
    @Override
    public void onResponse(Call<UserInfoModel> call,Response<UserInfoModel> response){
        <i>//å¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®</i>
    }
    @Override
    public void onFailure(Call<UserInfoModel> call,Throwable t){
    }
});
                </pre>
            </p>
            <p>
                <strong>â‘§å¤„ç†æœåŠ¡å™¨è¿”å›çš„æ•°æ®</strong><br />
            <pre>System.out.println("response","code:"+response.body().code);<i>//ç»“æœä¸º"code:1"</i></pre>
            </p>

        </div>
    </article>
</body>

</html>